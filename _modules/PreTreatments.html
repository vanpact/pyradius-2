<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PreTreatments &mdash; MasterThesis 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="MasterThesis 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">MasterThesis 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for PreTreatments</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. module:: PreTreatments</span>
<span class="sd">        :platform: Unix, Windows</span>
<span class="sd">        :synopsis: module which provide the preTreatments for the video.</span>
<span class="sd">    .. moduleauthor:: Yves-RÃ©mi Van Eycke &lt;yveycke [at] ulb.ac.be&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">cv2</span><span class="o">,</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">multiprocessing.pool</span> <span class="kn">import</span> <span class="n">ThreadPool</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">math</span>

<div class="viewcode-block" id="AbstractPreTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.AbstractPreTreatment">[docs]</a><span class="k">class</span> <span class="nc">AbstractPreTreatment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract class. All pretreatments inherit from this class&quot;&quot;&quot;</span>
<div class="viewcode-block" id="AbstractPreTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.AbstractPreTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="n">AbstractPreTreatment</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;This class is abstract and cannot be instantiated&#39;</span><span class="p">)</span> 
        <span class="nb">super</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

    </div></div>
<div class="viewcode-block" id="CannyTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.CannyTreatment">[docs]</a><span class="k">class</span> <span class="nc">CannyTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Canny edge detector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="CannyTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.CannyTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minThreshold</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">ratio</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">kernelSize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">L2gradient</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">        Constructor </span>
<span class="sd">		</span>
<span class="sd">        :param minThreshold: The minimum threshold used by the Canny edge detector</span>
<span class="sd">        :type minThreshold: int</span>
<span class="sd">        :param ratio: use to know the maximal threshold used by the Canny edge detector : maxThreshold=ratio*minThreshold</span>
<span class="sd">        :type ratio: float</span>
<span class="sd">        :param kernelSize: The size of the kernel used for the gradient computation</span>
<span class="sd">        :type kernelSize: int</span>
<span class="sd">        :param L2Gradient: The method used to computer the gradient value. If true, results are more accurate but the method is slower.</span>
<span class="sd">        :type L2Gradient: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CannyTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minThreshold</span> <span class="o">=</span> <span class="n">minThreshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="n">ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span> <span class="o">=</span> <span class="n">kernelSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L2gradient</span> <span class="o">=</span> <span class="n">L2gradient</span>
        </div>
<div class="viewcode-block" id="CannyTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.CannyTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">img</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span> <span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">sigmaX</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sigmaY</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="c">#        image = cv2.cvtColor( image, cv2.cv.CV_RGB2GRAY)</span>
<span class="c">#            img = cv2.blur(img, self.kernelSize)</span>
<span class="c">#            edges = cv2.medianBlur(numpy.uint8(img), 3)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minThreshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minThreshold</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span> <span class="n">apertureSize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="p">,</span> <span class="n">L2gradient</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L2gradient</span><span class="p">)</span><span class="c">#self.kernelSize )</span>
<span class="c">#            result = numpy.zeros( img.shape, img.dtype )</span>
    <span class="c">#        image.copyTo(result, edges)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The image must have 2 dimension(gray scale).&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">edges</span>
</div></div>
<div class="viewcode-block" id="GaussianBlurTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaussianBlurTreatment">[docs]</a><span class="k">class</span> <span class="nc">GaussianBlurTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gaussian blur</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="GaussianBlurTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaussianBlurTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernelSize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">Sigma</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param kernelSize: The size of the kernel used.</span>
<span class="sd">        :type kernelSize: int  </span>
<span class="sd">        :param Sigma: The variance of the gaussian function.</span>
<span class="sd">        :type Sigma: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GaussianBlurTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span> <span class="o">=</span> <span class="n">kernelSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmaX</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmaY</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        </div>
<div class="viewcode-block" id="GaussianBlurTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaussianBlurTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span> <span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="p">,</span> <span class="n">sigmaX</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmaX</span><span class="p">,</span> <span class="n">sigmaY</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmaY</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The image must have 2 dimension(gray scale).&quot;</span><span class="p">)</span>
    
        </div></div>
<div class="viewcode-block" id="GaborTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaborTreatment">[docs]</a><span class="k">class</span> <span class="nc">GaborTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The Gabor filter bank treatment&quot;&quot;&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">[]</span>
    
<div class="viewcode-block" id="GaborTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaborTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ksize</span> <span class="o">=</span> <span class="mi">31</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">lambd</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">psi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ktype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">angleToProcess</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param ksize: The size of the kernel used.</span>
<span class="sd">        :type ksize: int  </span>
<span class="sd">        :param sigma: The variance.</span>
<span class="sd">        :type sigma: float</span>
<span class="sd">        :param lambd: The wavelength</span>
<span class="sd">        :type lambd: int  </span>
<span class="sd">        :param gamma: The excentricity</span>
<span class="sd">        :type gamma: float</span>
<span class="sd">        :param psi: the offset</span>
<span class="sd">        :type psi: int  </span>
<span class="sd">        :param ktype: The type of the kernel value</span>
<span class="sd">        :type ktype: Numpy type</span>
<span class="sd">        :param angleToProcess: The angles to process</span>
<span class="sd">        :type angleToProcess: list of float  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GaborTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angleToProcess</span> <span class="o">=</span> <span class="n">angleToProcess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ksize</span> <span class="o">=</span> <span class="n">ksize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambd</span> <span class="o">=</span> <span class="n">lambd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi</span> <span class="o">=</span> <span class="n">psi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ktype</span> <span class="o">=</span> <span class="n">ktype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpuNumber</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpuNumber</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">ThreadPool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cpuNumber</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buildFilters</span><span class="p">()</span>
       </div>
<div class="viewcode-block" id="GaborTreatment.getGaborKernel"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaborTreatment.getGaborKernel">[docs]</a>    <span class="k">def</span> <span class="nf">getGaborKernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        create a Gabor kernel with all the arguments given in the constructor. the Theta is the last missing argument</span>
<span class="sd">        </span>
<span class="sd">        :param theta: The orientation of the kernel</span>
<span class="sd">        :type theta: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
        <span class="n">sigma_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
        <span class="n">nstds</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">ksize</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">):</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ksize</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">nstds</span><span class="o">*</span><span class="n">sigma_x</span><span class="o">*</span><span class="n">c</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">nstds</span><span class="o">*</span><span class="n">sigma_y</span><span class="o">*</span><span class="n">s</span><span class="p">))</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">xmax</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="n">ymax</span>
        <span class="n">xmin</span><span class="o">=-</span><span class="n">xmax</span>
<span class="c">#        if( self.ksize &gt; 0 ):</span>
<span class="c">#            ymax = self.ksize/2</span>
<span class="c">#        else:</span>
<span class="c">#            ymax = max(math.fabs(nstds*sigma_x*c), math.fabs(nstds*sigma_y*s))</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ktype</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span><span class="c">#1/(2*numpy.pi*sigma_x*sigma_y)</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">sigma_x</span><span class="o">*</span><span class="n">sigma_x</span><span class="p">)</span>
        <span class="n">ey</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">sigma_y</span><span class="o">*</span><span class="n">sigma_y</span><span class="p">)</span>
        <span class="n">cscale</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lambd</span>
        
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">):</span>
                <span class="n">xr</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">c</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">s</span>
                <span class="n">yr</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">s</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">c</span>
<span class="c">#                v = scale*math.exp(ex*xr*xr + ey*yr*yr)*math.cos(cscale*xr + self.psi)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ex</span><span class="o">*</span><span class="n">xr</span><span class="o">*</span><span class="n">xr</span> <span class="o">+</span> <span class="n">ey</span><span class="o">*</span><span class="n">yr</span><span class="o">*</span><span class="n">yr</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">cscale</span><span class="o">*</span><span class="n">xr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">)</span>
                <span class="n">kernel</span><span class="p">[</span><span class="n">ymax</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">kernel</span>
    </div>
<div class="viewcode-block" id="GaborTreatment.buildFilters"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaborTreatment.buildFilters">[docs]</a>    <span class="k">def</span> <span class="nf">buildFilters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;                </span>
<span class="sd">        build all the kernel for the Gabor bank filter. the orientation is the varying parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angleToProcess</span><span class="o">==</span><span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angleToProcess</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angleToProcess</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ksize&#39;</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">ksize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ksize</span><span class="p">),</span> <span class="s">&#39;sigma&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="s">&#39;theta&#39;</span><span class="p">:</span><span class="n">theta</span><span class="p">,</span> <span class="s">&#39;lambd&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">lambd</span><span class="p">,</span>
                      <span class="s">&#39;gamma&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span> <span class="s">&#39;psi&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="s">&#39;ktype&#39;</span><span class="p">:</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">}</span>
            <span class="n">kern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGaborKernel</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">ks</span><span class="o">=</span><span class="n">kern</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span><span class="p">(</span><span class="n">ks</span> <span class="o">&gt;</span><span class="mf">0.01</span><span class="p">):</span>
                <span class="n">kern</span> <span class="o">=</span> <span class="n">kern</span><span class="o">/</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">kern</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span>
    </div>
<div class="viewcode-block" id="GaborTreatment.process"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaborTreatment.process">[docs]</a>    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">accum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="c">#        angle = numpy.zeros_like(img,dtype=numpy.float32)</span>
        <span class="k">for</span> <span class="n">kern</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
<span class="c">#            fimg = numpy.zeros_like(img, img.dtype)</span>
<span class="c">#            kern = numpy.ones(kern.shape, kern.dtype)</span>
<span class="c">#            cv2.cv.Filter2D(cv2.cv.fromarray(img), cv2.cv.fromarray(fimg), cv2.cv.fromarray(kern))</span>
<span class="c">#            if(len(img.shape)&gt;2):</span>
<span class="c">#                for d in range(0, img.shape[2]):</span>
<span class="c">#                    tmp = numpy.copy(img[:, :, d])</span>
<span class="c">#                    fimg[:, :, d] = cv2.filter2D(tmp, cv2.CV_8U, kern)</span>
<span class="c">#            elif(len(img.shape)==2):</span>
            <span class="n">fimg</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">filter2D</span><span class="p">(</span><span class="n">img</span><span class="p">[:,</span> <span class="p">:],</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CV_8U</span><span class="p">,</span> <span class="n">kern</span><span class="p">)</span>
            
<span class="c">#            else:</span>
<span class="c">#                raise ValueError(&quot;The image must have 2 or 3 dimension.&quot;)</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">accum</span><span class="p">,</span> <span class="n">fimg</span><span class="p">,</span> <span class="n">accum</span><span class="p">)</span>
            <span class="k">del</span><span class="p">(</span><span class="n">fimg</span><span class="p">)</span>
<span class="c">#            angle[numpy.equal(fimg,accum)] = params[&#39;theta&#39;]</span>
        <span class="k">del</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">accum</span>
</div>
<div class="viewcode-block" id="GaborTreatment.processThreaded"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaborTreatment.processThreaded">[docs]</a>    <span class="k">def</span> <span class="nf">processThreaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image (multi-threaded version of process).</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">accum</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="c">#        angle = numpy.zeros_like(img,dtype=numpy.float32)</span>
        <span class="n">accumLock</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="c">#        idx=None</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">filt</span><span class="p">):</span>
            <span class="n">kern</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">filt</span>
<span class="c">#            fimg = numpy.zeros_like(img, img.dtype)</span>
<span class="c">#            if(len(img.shape)&gt;2):</span>
<span class="c">#                for d in range(0, img.shape[2]):</span>
<span class="c">#                    tmp = numpy.copy(img[:, :, d])</span>
<span class="c">#                    fimg[:, :, d] = cv2.filter2D(tmp, cv2.CV_8U, kern)</span>
<span class="c">#            elif(len(img.shape)==2):</span>
            <span class="n">fimg</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">filter2D</span><span class="p">(</span><span class="n">img</span><span class="p">[:,</span> <span class="p">:],</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CV_8U</span><span class="p">,</span> <span class="n">kern</span><span class="p">)</span>
<span class="c">#            else:</span>
<span class="c">#                raise ValueError(&quot;The image must have 2 or 3 dimension.&quot;)</span>
            <span class="k">with</span> <span class="n">accumLock</span><span class="p">:</span>
<span class="c">#                if(len(img.shape)&gt;2):</span>
<span class="c">#                    for d in range(0, img.shape[2]):</span>
<span class="c">#                        idx = numpy.argmax(numpy.dstack((accum[:, :, d], fimg[:, :, d])),axis=2)</span>
<span class="c">#                        accum[:, :, d][idx==1]=fimg[:, :, d][idx==1]</span>
<span class="c">#                        angle[:, :, d][idx==1]=numpy.sin(params[&#39;theta&#39;])*100</span>
<span class="c">#                elif(len(img.shape)==2):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">accum</span><span class="p">,</span> <span class="n">fimg</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">accum</span><span class="p">[</span><span class="n">idx</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">fimg</span><span class="p">[</span><span class="n">idx</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">idx</span>
            <span class="k">del</span> <span class="n">fimg</span>
            <span class="k">del</span> <span class="n">kern</span>
            <span class="k">del</span> <span class="n">filt</span>
<span class="c">#            angle[idx==1]=numpy.sin(params[&#39;theta&#39;])*100</span>
<span class="c">#                else:</span>
<span class="c">#                    raise ValueError(&quot;The image must have 2 or 3 dimension.&quot;)</span>
    
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">accum</span>
    </div>
<div class="viewcode-block" id="GaborTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.GaborTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image by using process or processThreaded (choice is made automatically).</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpuNumber</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processThreaded</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The image must have 2 dimension(gray scale).&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span>
</div></div>
<div class="viewcode-block" id="ReduceSizeTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.ReduceSizeTreatment">[docs]</a><span class="k">class</span> <span class="nc">ReduceSizeTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reduce the size of an image&quot;&quot;&quot;</span>
<div class="viewcode-block" id="ReduceSizeTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.ReduceSizeTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dstSize</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param dstSize: The final size</span>
<span class="sd">        :type dstSize: Tuple of int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReduceSizeTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dstSize</span><span class="o">=</span><span class="n">dstSize</span>
        </div>
<div class="viewcode-block" id="ReduceSizeTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.ReduceSizeTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">pyrDown</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">dstsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dstSize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The image must have 2 dimension(gray scale).&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="IncreaseSizeTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.IncreaseSizeTreatment">[docs]</a><span class="k">class</span> <span class="nc">IncreaseSizeTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Increase the size of an image&quot;&quot;&quot;</span>
<div class="viewcode-block" id="IncreaseSizeTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.IncreaseSizeTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dstSize</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param dstSize: The final size</span>
<span class="sd">        :type dstSize: Tuple of int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IncreaseSizeTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dstSize</span><span class="o">=</span><span class="n">dstSize</span>
    </div>
<div class="viewcode-block" id="IncreaseSizeTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.IncreaseSizeTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">pyrUp</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">dstsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dstSize</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The image must have 2 dimension(gray scale).&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="changeContrastTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.changeContrastTreatment">[docs]</a><span class="k">class</span> <span class="nc">changeContrastTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Change the contrast of the image&quot;&quot;&quot;</span>
<div class="viewcode-block" id="changeContrastTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.changeContrastTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param value: Contrast multiplier</span>
<span class="sd">        :type value: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">changeContrastTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">value</span>
    </div>
<div class="viewcode-block" id="changeContrastTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.changeContrastTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                <span class="n">image</span><span class="p">[</span><span class="n">image</span> <span class="o">&gt;</span><span class="mi">255</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
                <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The image must have 2 dimension(gray scale).&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="cropTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.cropTreatment">[docs]</a><span class="k">class</span> <span class="nc">cropTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Crop the image&quot;&quot;&quot;</span>
<div class="viewcode-block" id="cropTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.cropTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roi</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param roi: Coordinates of the region of interest</span>
<span class="sd">        :type roi: Tuple of Tuple of int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">cropTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">roi</span> <span class="o">=</span> <span class="n">roi</span>
    </div>
<div class="viewcode-block" id="cropTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.cropTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">img</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Incorrect size for the region of interest when cropping.&quot;</span><span class="p">)</span>    
</div></div>
<div class="viewcode-block" id="rotateTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.rotateTreatment">[docs]</a><span class="k">class</span> <span class="nc">rotateTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rotate the image&quot;&quot;&quot;</span>
<div class="viewcode-block" id="rotateTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.rotateTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param angle: The angle of rotation</span>
<span class="sd">        :type value: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">rotateTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAngle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="rotateTreatment.setAngle"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.rotateTreatment.setAngle">[docs]</a>    <span class="k">def</span> <span class="nf">setAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Change the angle</span>
<span class="sd">        </span>
<span class="sd">        :param angle: The angle of rotation</span>
<span class="sd">        :type angle: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="o">=</span><span class="n">angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="rotateTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.rotateTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">sizemaxX</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="c">#-beta*img.shape[0])</span>
        <span class="n">sizemaxY</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">sizemaxX</span><span class="p">,</span> <span class="n">sizemaxY</span><span class="p">),</span> <span class="n">borderMode</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_WRAP</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="c">#[sizemaxY/2-30:sizemaxY/2+30, 0:sizemaxX]</span>
        </div></div>
<div class="viewcode-block" id="LaplacianTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.LaplacianTreatment">[docs]</a><span class="k">class</span> <span class="nc">LaplacianTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform filtering using a Laplacian of Gaussian&quot;&quot;&quot;</span>
<div class="viewcode-block" id="LaplacianTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.LaplacianTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernelSize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param kernelSize: The kernel size</span>
<span class="sd">        :type kernelSize: int</span>
<span class="sd">        :param scale: The scale factor computer for the laplacian value</span>
<span class="sd">        :type scale: float</span>
<span class="sd">        :param delta: value added to the results</span>
<span class="sd">        :type delta: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LaplacianTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="o">=</span><span class="n">kernelSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">=</span><span class="n">delta</span>
    </div>
<div class="viewcode-block" id="LaplacianTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.LaplacianTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c">#        img= cv2.GaussianBlur( img, (9, 9), sigmaX=0, sigmaY=0)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Laplacian</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">ddepth</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_32F</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">);</span>
<span class="c">#        result = -result</span>
        <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">((</span><span class="n">result</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">result</span><span class="p">))</span><span class="o">*</span><span class="mf">255.0</span><span class="p">)</span>
<span class="c">#        result[result&lt;50]=0</span>
    </div></div>
<div class="viewcode-block" id="SobelTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.SobelTreatment">[docs]</a><span class="k">class</span> <span class="nc">SobelTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the Sobel derivative of an image&quot;&quot;&quot;</span>
<div class="viewcode-block" id="SobelTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.SobelTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernelSize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param dx: The order of the x derivative</span>
<span class="sd">        :type kernelSize: int</span>
<span class="sd">        :param dy: The order of the y derivative</span>
<span class="sd">        :type dy: float</span>
<span class="sd">        :param kernelSize: The kernel size</span>
<span class="sd">        :type kernelSize: int</span>
<span class="sd">        :param scale: The scale factor for the derivative values</span>
<span class="sd">        :type scale: float</span>
<span class="sd">        :param delta: value added to the results</span>
<span class="sd">        :type delta: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SobelTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">=</span><span class="n">dx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="o">=</span><span class="n">dy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="o">=</span><span class="n">kernelSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">=</span><span class="n">delta</span>
    </div>
<div class="viewcode-block" id="SobelTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.SobelTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c">#        img= cv2.GaussianBlur( img, (31,31), sigmaX=1.0, sigmaY=1.0)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Sobel</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">ddepth</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_32F</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">);</span>
        <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c">#        result = numpy.abs(result)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">del</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">((</span><span class="n">result</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">result</span><span class="p">))</span><span class="o">*</span><span class="mf">255.0</span><span class="p">)</span>
<span class="c">#        result = cv2.convertScaleAbs( result)</span>
<span class="c">#        result[result&lt;50]=0</span>
        <span class="k">return</span> <span class="n">result</span>
    
<span class="c">#     def compute2(self, img):</span>
<span class="c"># #        img = cv2.GaussianBlur( img, (7, 7), sigmaX=0.0, sigmaY=0.0);</span>
<span class="c">#         grad_x = cv2.Sobel( numpy.uint8(img), ddepth=cv2.CV_32F, dx=1, dy=0, ksize=7, scale=1, delta=0)</span>
<span class="c"># #        abs_grad_x = cv2.convertScaleAbs( grad_x,  alpha=255.0/numpy.max(numpy.abs(grad_x)))</span>
<span class="c">#         </span>
<span class="c">#         grad_y = cv2.Sobel( numpy.uint8(img), ddepth=cv2.CV_32F, dx=0, dy=1, ksize=7, scale=1, delta=0)</span>
<span class="c"># #        abs_grad_y = cv2.convertScaleAbs( grad_y,  alpha=255.0/numpy.max(numpy.abs(grad_y)))</span>
<span class="c">#         norm =  numpy.sqrt(numpy.add(numpy.square(numpy.asarray(grad_x, dtype=numpy.float)), numpy.square(numpy.asarray(grad_y, dtype=numpy.float))))#cv2.addWeighted( numpy.abs(grad_x), 0.5, numpy.abs(grad_y), 0.5, 0)</span>
<span class="c">#         return numpy.asarray((norm/numpy.max(norm))*255.0, dtype=numpy.uint8)</span></div></div>
<div class="viewcode-block" id="DOHTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.DOHTreatment">[docs]</a><span class="k">class</span> <span class="nc">DOHTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the determinant of the Hessian matrix&quot;&quot;&quot;</span>
<div class="viewcode-block" id="DOHTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.DOHTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernelSize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param kernelSize: The kernel size</span>
<span class="sd">        :type kernelSize: int</span>
<span class="sd">        :param scale: The scale factor for the derivative values</span>
<span class="sd">        :type scale: float</span>
<span class="sd">        :param delta: value added to the results</span>
<span class="sd">        :type delta: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DOHTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="o">=</span><span class="n">kernelSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">=</span><span class="n">delta</span>
    </div>
<div class="viewcode-block" id="DOHTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.DOHTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c">#        img= cv2.GaussianBlur( img, (9, 9), sigmaX=0, sigmaY=0)</span>
        <span class="n">resultxy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Sobel</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">ddepth</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_32F</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">);</span>
        <span class="n">resultxx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Sobel</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">ddepth</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_32F</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">);</span>
        <span class="n">resultyy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Sobel</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">ddepth</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_32F</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernelSize</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">);</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">resultxx</span><span class="o">*</span><span class="n">resultyy</span><span class="o">-</span><span class="n">resultxy</span><span class="o">*</span><span class="n">resultxy</span>
        
        <span class="n">result</span><span class="p">[</span><span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">result</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">resultxx</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">))]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">result</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">result</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">resultxx</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">))]</span><span class="o">=</span><span class="mi">255</span>
<span class="c">#        result[result&lt;numpy.median(result)]=0</span>
<span class="c">#        result = result-numpy.median(result)</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">((</span><span class="n">result</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">result</span><span class="p">))</span><span class="o">*</span><span class="mf">255.0</span><span class="p">)</span>
<span class="c">#        result[result&lt;50]=0</span>
   
<span class="c"># class rotationTreatment(AbstractPreTreatment):</span>
<span class="c">#     def __init__(self, angle):</span>
<span class="c">#         super(rotationTreatment, self).__init__()</span>
<span class="c">#         self.angle = angle</span>
<span class="c">#         </span>
<span class="c">#     def compute(self, img):</span>
<span class="c">#         &quot;&quot;&quot;        </span>
<span class="c">#         :param img: The image to process</span>
<span class="c">#         :type img: Numpy array    </span>
<span class="c">#         :return: The processed image</span>
<span class="c">#         :rtype: Numpy array</span>
<span class="c">#         </span>
<span class="c">#         Process one image.</span>
<span class="c">#         &quot;&quot;&quot;</span>
<span class="c">#         center = (img.shape[0]/2.0, img.shape[1]/2.0)</span>
<span class="c">#         M = cv2.getRotationMatrix2D(center, self.angle, 1.0)</span>
<span class="c">#         alpha = numpy.cos(-numpy.radians(self.angle))</span>
<span class="c">#         beta = numpy.sin(-numpy.radians(self.angle))</span>
<span class="c">#         sizemaxX = numpy.int(alpha*img.shape[1])#-beta*img.shape[0])</span>
<span class="c">#         sizemaxY = numpy.int(beta*img.shape[1]+alpha*img.shape[0])</span>
<span class="c">#         result = cv2.warpAffine(img, M, (sizemaxX, sizemaxY))</span>
<span class="c">#         return result[result.shape[0]/2-30:result.shape[0]/2+30, 0:result.shape[1]].copy()</span>
    </div></div>
<div class="viewcode-block" id="ThresholdTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.ThresholdTreatment">[docs]</a><span class="k">class</span> <span class="nc">ThresholdTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;Perform Thesholding&quot;&quot;&quot;</span>
<div class="viewcode-block" id="ThresholdTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.ThresholdTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param threshold: The threshold. -1 means automatic threshold.</span>
<span class="sd">        :type threshold: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ThresholdTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        </div>
<div class="viewcode-block" id="ThresholdTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.ThresholdTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">img</span><span class="o">&gt;=</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
        <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">img</span><span class="o">&gt;</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="mi">0</span><span class="p">)])</span>
        <span class="n">img</span><span class="p">[</span><span class="n">img</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">img</span><span class="p">[</span><span class="n">img</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">]</span><span class="o">=</span><span class="mi">255</span>
        <span class="k">return</span> <span class="n">img</span>
    </div></div>
<div class="viewcode-block" id="addHlineTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.addHlineTreatment">[docs]</a><span class="k">class</span> <span class="nc">addHlineTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;add horizontal white line on the image&quot;&quot;&quot;</span>
<div class="viewcode-block" id="addHlineTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.addHlineTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lineDistance</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param thickness: The line thickness</span>
<span class="sd">        :type thickness: int</span>
<span class="sd">        :param lineDistance: The distance between the lines</span>
<span class="sd">        :type lineDistance: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">addHlineTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">thickness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineDistance</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">lineDistance</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="addHlineTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.addHlineTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c">#        lineNumber = numpy.int(y/self.lineDistance)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineDistance</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lineDistance</span><span class="p">):</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">thickness</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        </div></div>
<div class="viewcode-block" id="DilationTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.DilationTreatment">[docs]</a><span class="k">class</span> <span class="nc">DilationTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform morphological dilation&quot;&quot;&quot;</span>
<div class="viewcode-block" id="DilationTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.DilationTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_RECT</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param morphology: The shape of the mask</span>
<span class="sd">        :type morphology: int</span>
<span class="sd">        :param size: The size of the shape</span>
<span class="sd">        :type size: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DilationTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="o">=</span><span class="n">morphology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">size</span>
        </div>
<div class="viewcode-block" id="DilationTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.DilationTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elem</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span><span class="c">#cv2.dilate(cv2.erode(img, elem), elem)</span>
</div></div>
<div class="viewcode-block" id="erosionTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.erosionTreatment">[docs]</a><span class="k">class</span> <span class="nc">erosionTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform morphological erosion&quot;&quot;&quot;</span>
<div class="viewcode-block" id="erosionTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.erosionTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_RECT</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param morphology: The shape of the mask</span>
<span class="sd">        :type morphology: int</span>
<span class="sd">        :param size: The size of the shape</span>
<span class="sd">        :type size: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">erosionTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="o">=</span><span class="n">morphology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">size</span>
        </div>
<div class="viewcode-block" id="erosionTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.erosionTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elem</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span><span class="c">#cv2.dilate(cv2.erode(img, elem), elem)</span>
</div></div>
<div class="viewcode-block" id="SkeletonTreatment"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.SkeletonTreatment">[docs]</a><span class="k">class</span> <span class="nc">SkeletonTreatment</span><span class="p">(</span><span class="n">AbstractPreTreatment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute morphological skeleton of blobs in an image&quot;&quot;&quot;</span>
<div class="viewcode-block" id="SkeletonTreatment.__init__"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.SkeletonTreatment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        :param size: The size of the cross shaped mask used in the method</span>
<span class="sd">        :type size: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SkeletonTreatment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">size</span>
        </div>
<div class="viewcode-block" id="SkeletonTreatment.compute"><a class="viewcode-back" href="../PreTreatments.html#PreTreatments.SkeletonTreatment.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        Process one image.</span>
<span class="sd">        </span>
<span class="sd">        :param img: The image to process</span>
<span class="sd">        :type img: Numpy array    </span>
<span class="sd">        :return: The processed image</span>
<span class="sd">        :rtype: Numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getStructuringElement</span><span class="p">(</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CROSS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="n">skel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="n">done</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
            <span class="n">skel</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">skel</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">done</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="c">#        for i in numpy.arange(0, 20, 1):</span>
<span class="c">#            elem = numpy.array([(-1, -1, -1),(0, 1, 0),(1, 1, 1)], dtype=numpy.int8)</span>
<span class="c">#            img = self.erodeSP(img, elem)</span>
<span class="c">#            elem = numpy.array([(0, -1, -1),(1, 1, -1),(1, 1, 0)], dtype=numpy.int8)</span>
<span class="c">#            img = self.erodeSP(img, elem)</span>
<span class="c">#            elem = numpy.array([(-1, 0, 1),(-1, 1, 1),(-1, 0, 1)], dtype=numpy.int8)</span>
<span class="c">#            img = self.erodeSP(img, elem)</span>
<span class="c">#            elem = numpy.array([(-1, -1, 0),(-1, 1, 1),(0, 1, 0)], dtype=numpy.int8)</span>
<span class="c">#            img = self.erodeSP(img, elem)</span>
<span class="c">#            elem = numpy.array([(1, 1, 1),(0, 1, 0),(-1, -1, -1)], dtype=numpy.int8)</span>
<span class="c">#            img = self.erodeSP(img, elem)</span>
<span class="c">#            elem = numpy.array([(0, 1, 0),(-1, 1, 1),(-1, -1, 0)], dtype=numpy.int8)</span>
<span class="c">#            img = self.erodeSP(img, elem)</span>
<span class="c">#            elem = numpy.array([(1, 0, -1),(1, 1, -1),(1, 0, -1)], dtype=numpy.int8)</span>
<span class="c">#            img = self.erodeSP(img, elem)</span>
<span class="c">#            elem = numpy.array([(0, 1, 0),(1, 1, -1),(0, -1, -1)], dtype=numpy.int8)</span>
<span class="c">#            img = self.erodeSP(img, elem)</span>
        <span class="k">return</span> <span class="n">skel</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span>
<span class="c">#     def erodeSP(self, img, elem):</span>
<span class="c">#         &quot;&quot;&quot;        </span>
<span class="c">#         :param img: The image to process</span>
<span class="c">#         :type img: Numpy array</span>
<span class="c">#         :param elem: The size of the shape</span>
<span class="c">#         :type elem: int</span>
<span class="c">#         </span>
<span class="c">#         Special erosion function. internal to the class.</span>
<span class="c">#         &quot;&quot;&quot;</span>
<span class="c">#         imgPre = numpy.copy(img)</span>
<span class="c">#         for y in numpy.arange(1, img.shape[0]-2, 1):</span>
<span class="c">#             for x in (1, img.shape[1]-2, 1):</span>
<span class="c">#                 tmp = numpy.copy(img[max(y-numpy.int(elem.shape[0]/2), 0):min(y+numpy.int(elem.shape[0]/2)+1, img.shape[0]), max(x-numpy.int(elem.shape[1]/2), 0):min(x+numpy.int(elem.shape[1]/2)+1, img.shape[1])]).astype(numpy.int)</span>
<span class="c">#                 tmp[numpy.where(elem==-1)] = -1</span>
<span class="c">#                 tmp[numpy.where(tmp&gt;0)] = 1</span>
<span class="c">#                 if(numpy.all(elem == tmp) and tmp[1][1]!=1 or (not(numpy.all(elem == tmp)) and tmp[1][1]==1)):</span>
<span class="c">#                     imgPre[y][x] = 255 if (numpy.all(elem == tmp)) else 0</span>
<span class="c">#         return imgPre</span>
    
<span class="c"># class ThinningTreatment(AbstractTreatment):</span>
<span class="c">#     def __init__(self, size=(3, 3)):</span>
<span class="c">#         super(ThinningTreatment, self).__init__()</span>
<span class="c">#         self.size=size</span>
<span class="c">#     def thinningIteration(self, img, itera):</span>
<span class="c">#         marker = numpy.zeros_like(img, dtype = numpy.uint8)</span>
<span class="c">#         for y in numpy.arange(1, img.shape[0]-2, 1):</span>
<span class="c">#             for x in numpy.arange(1, img.shape[1]-2, 1):</span>
<span class="c">#                 v2 = img[y-1, x]</span>
<span class="c">#                 v3 = img[y-1, x+1]</span>
<span class="c">#                 v4 = img[y, x+1]</span>
<span class="c">#                 v5 = img[y+1, x+1]</span>
<span class="c">#                 v6 = img[y+1, x]</span>
<span class="c">#                 v7 = img[y+1, x-1]</span>
<span class="c">#                 v8 = img[y, x-1]</span>
<span class="c">#                 v9 = img[y-1, x-1]</span>
<span class="c">#                 B = v2 + v3 + v4 + v5 + v6 + v7 + v8 + v9</span>
<span class="c">#                 if(B &gt;= 2 and B &lt;= 6):</span>
<span class="c">#                     if(itera == 0):</span>
<span class="c">#                         m1 = (v2 * v4 * v6)</span>
<span class="c">#                         m2 = (v4 * v6 * v8)</span>
<span class="c">#                     else :</span>
<span class="c">#                         m1 = (v2 * v4 * v8)</span>
<span class="c">#                         m2 = (v2 * v6 * v8)</span>
<span class="c">#                     if( m1 == 0 and m2 == 0):</span>
<span class="c">#                         v2 = v2==0</span>
<span class="c">#                         v3 = v3==0</span>
<span class="c">#                         v4 = v4==0</span>
<span class="c">#                         v5 = v5==0</span>
<span class="c">#                         v6 = v6==0</span>
<span class="c">#                         v7 = v7==0</span>
<span class="c">#                         v8 = v8==0</span>
<span class="c">#                         v9 = v9==0</span>
<span class="c">#                         A = (sum([(v2 and not v3), (v3 and not v4), (v4 and not v5), (v5 and not v6), (v6 and not v7), (v7 and not v8), (v8 and not v9), (v9 and not v2)]))</span>
<span class="c">#                         if (A == 1): </span>
<span class="c">#                             marker[y][x] = 1</span>
<span class="c">#         return numpy.logical_and(img, numpy.logical_not(marker)).astype(numpy.uint8)</span>
<span class="c">#     def compute(self, img):</span>
<span class="c">#         img[numpy.where(img&gt;0)] = 1</span>
<span class="c">#         prev = numpy.zeros_like(img, dtype = numpy.uint8)</span>
<span class="c">#         diff=None</span>
<span class="c">#     </span>
<span class="c">#         while (numpy.sum(diff) &gt; 0 or diff==None):</span>
<span class="c">#             img = self.thinningIteration(img, 0)</span>
<span class="c">#             img = self.thinningIteration(img, 1)</span>
<span class="c">#             diff = cv2.absdiff(img, prev)</span>
<span class="c">#             prev = numpy.copy(img)</span>
<span class="c">#     </span>
<span class="c">#         return img.astype(numpy.uint8)*255</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">MasterThesis 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Yves-RÃ©mi Van Eycke.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>